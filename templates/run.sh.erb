# runhive.sh.erb - generated by <%= datasource.authorName %> via 'Carrie' UI
# Copyright 2014 org name added here later
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# 

YYYY_MM_DD=$(date +%Y-%m-%d)

hdfs dfs -mkdir <%= datasource.hdfsDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/schema
hdfs dfs -mkdir <%= datasource.hdfsDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/data/etl_date=$YYYY_MM_DD
hdfs dfs -put <%= datasource.ftpTargetDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/<%= datasource.tableName %>.avsc <%= datasource.hdfsDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/schema
hdfs dfs -put <%= datasource.ftpTargetDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/<%= datasource.tableName %>.avro <%= datasource.hdfsDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/data/etl_date=$YYYY_MM_DD
hdfs dfs -chmod -R 777 <%= datasource.hdfsDir %>

echo "ALTER TABLE <%= datasource.tableName %> ADD IF NOT EXISTS PARTITION (etl_date='$YYYY_MM_DD') LOCATION 'hdfs://localhost.localdomain:8020/user/cloudera/<%= datasource.hdfsDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/data/etl_date=$YYYY_MM_DD';" > <%= datasource.ftpTargetDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/runAlterTable.hive

hive -f <%= datasource.ftpTargetDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/run.hive
hive -f <%= datasource.ftpTargetDir %>/<%= datasource.uniqueName %>/<%= datasource.tableName %>/runAlterTable.hive
