# Copyright 2014 <%= datasource.authorName %>
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
# 
# This file generated by <%= datasource.authorName %> via 'Carrie' UI

YYYY_MM_DD=TODAY=$(date +%Y-%m-%d)

create database if not exists <%= datasource.hiveDb %>;

use <%= datasource.hiveDb %>;
 
# DROP TABLE IF EXISTS `<%= datasource.hiveDb %>`.<%= datasource.tableName %>;

CREATE EXTERNAL TABLE IF NOT EXISTS <%= datasource.tableName %>
  PARTITIONED BY (etl_date STRING<%= datasource.partitionDdl %>)
  ROW FORMAT SERDE
  'org.apache.hadoop.hive.serde2.avro.AvroSerDe'
  STORED as INPUTFORMAT
  'org.apache.hadoop.hive.ql.io.avro.AvroContainerInputFormat'
  OUTPUTFORMAT
  'org.apache.hadoop.hive.ql.io.avro.AvroContainerOutputFormat'
  LOCATION '<%= datasource.hdfsDir %>/<%= datasource.tableName %>/'
  TBLPROPERTIES (
    'avro.schema.url'='<%= datasource.hdfsDir %>/<%= datasource.tableName %>.avsc');

ALTER TABLE <%= datasource.tableName %> ADD IF NOT EXISTS PARTITION (etl_date='$YYYY_MM_DD') LOCATION '<%= datasource.hdfsDir %>/etl_date=$YYYY_MM_DD';"
